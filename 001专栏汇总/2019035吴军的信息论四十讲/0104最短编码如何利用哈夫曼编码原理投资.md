# 0104. 最短编码：如何利用哈夫曼编码原理投资？
> 吴军·信息论 40 讲
2019-06-02

如何对信息进行编码才最有效？这个问题一直困扰着人们，我在《科技史纲 60 讲》中介绍莫尔斯电码时讲到，他根据常识对经常出现的字母采用较短的编码，对不常见的字母用较长的编码，这样就可以降低编码的整体长度。

下面这张图，其中圆点（嘀）代表电报机的继电器短暂的接触，长线（嗒）代表长时间的接触（要求至少是短接触时长的三倍以上）。

那么，莫尔斯电码确实做到了更有效的编码，但那是不是最优呢？还能不能更短呢？人们对此并不知道。我们知道，如果对英语 26 个字母采用等长度的编码，比如进行二进制编码，需要 log26。

注：我要补充一下，在我们的课程中，默认 log 函数的底都是 2，也就是二进制 0 或 1 在每一位上的两种可能，需要多少位，就是多少个次方，也就是多少个比特的信息。

那么 log26 就是约 5 比特信息。而采用莫尔斯的编码方法，平均只需要 3 比特，这个效率就高了很多，这样发报，时间就能节省大约 1/3 左右。

我们在谍战片中经常看到报务员还没有发完报，敌方的特工就冲了进来，这种场景并不完全是虚构的，因为在二战时欧洲德占区这种情景时常出现，因此省一点时间就意味着自身的安全。即使不考虑战争中的特殊情况，省掉三分之一的通信成本，也是很可观的。

无独有偶，全世界除美国之外，各国在设计长途电话区位码的时候，也充分考虑了每一个城市和地区的电话机数量，比如在中国北京、上海等重要城市就是两位，小城市就使用 3 位，这样做的目的是为了减少平均的编码长度。那么是否能够证明，越常出现的信息采用较短的编码，不常出现的信息采用较长的编码，就能比采用同样码长的信息总体上更合算呢？答案是肯定的。

详细的推导步骤：

我们不妨看一个具体的例子。我们假定有 32 条信息，每条信息出现的概率分别为 1/2、1/4、1/8、1/16…… 依次递减，最后 31、32 两个信息出现的概率是 1/2^31、1/2^31（这样 32 个信息的出现概率加起来就是 1 了）。现在需要用二进制数对它们进行编码。等长度和不等长度两种编码方法，我们来对比一下：

方法一：采用等长度编码，码长为 5。因为是 log32=5 比特。

方法二：不等长度编码，如果出现概率高就短一些，概率低就长一些。

我们把第一条信息用 0 编码，第二条用 10 编码，第三条用 110 编码…… 最后 31、32 两条出现概率相同，都很低，码长都是 31。第 31 条信息就用 1111……110（30 个 1 加 1 个 0）编码，第 32 条信息，就用 1111……111（31 个 1）来编码。这样的编码虽然大部分码的长度都超过了 5，但是乘以出现概率后，平均码长只有 2，也就是说节省了 60% 的码长。如果利用这个原理进行数据压缩，可以在不损失任何信息的情况下压缩掉 60%。

事实上，这种最短编码方法等于香农第一定律的继续，它最早是由 MIT 的教授哈夫曼发明的，因此也被称为「哈夫曼编码」。关于哈夫曼编码有三个要点值得一提：

1、如果你还记得第 5 讲的香农第一定律，一定知道编码长度是有个理论最小值的，从数学上可以证明哈夫曼的这种编码方法是最优化的。

2、哈夫曼编码从本质上讲，是将最宝贵的资源（最短的编码）给出现概率最大的信息。至于资源如何分配，哈夫曼给出了一个原则，也就是一条信息编码的长度和出现概率的对数成正比。

注：比如在上面的例子中，第一条消息出现的概率为 1/2，我们知道 1/2（以二为底）的对数等于 - 1，因此它的编码长度就是 1（即码 0）。最后两条消息出现的概率为 1/2^31 次方，取对数后等于 - 31，因此它们的编码长度就是 31。

如果我们回顾一下莫尔斯电码，就会发现它是不自觉地采用了哈夫曼编码的原理。只是它没有严格统计各个字母的频率，没有完全做到最优化。在一个极端的情况下，如果所有的信息出现的概率相同，采用哈夫曼编码，每一条信息的码长都一样，这时哈夫曼编码就变成了等长编码，没有优势了。

3、在现实生活中，很多信息的组合，比单独一条信息，其概率分布差异更大，因此对它们使用哈夫曼编码进行信息压缩，压缩比会更高。比如说，在汉语中，如果对汉字的频率进行统计，然后压缩，一篇文章通常能压缩掉 50% 以上，但是如果按照词进行频率统计，再用哈夫曼编码压缩，可以压缩掉 70% 以上。

讲完了哈夫曼编码的原则，那么它又是怎么应用到我们的工作生活中呢？其实，但凡需要分配资源的工作，它都有指导意义。我在《浪潮之巅》一书中介绍凯鹏华盈时讲，虽然换了三代掌门人，但它能在四十多年，20 多期基金中，平均每一期基金的回报总是有 40 倍左右，这说明它不是靠一两个人天才的眼光，而是有一整套系统的方法，保证投资的成功率。那么它投资方法中的秘诀是什么呢？其实就是哈夫曼编码的原理，即通过每一次双倍砸钱（double down），把最多的钱投入到最容易成功的项目上。它具体操作的方法可以用这样一个例子来说明。

我们假定一期基金有 1 亿美元可以用来进行风险投资，怎样投资效果最好？我们列出三个做法：

1. 平均地投入到 100 个初创公司。

2. 利用我们的眼光投入到一家最可能的公司中。

3. 利用哈夫曼编码原理投资。

我们还假设如果投资的公司最后能上市，将获得 50 倍的回报；如果上不了市，只是在下一轮融资被收购，将获得 3～5 倍的回报。在硅谷地区，获得投资的公司最终能上市的概率大约是 1%，大家不要觉得这个比例低，它已经比世界其他地区，包括美国硅谷以外的地区和中国，高很多了。至于被收购的概率，在硅谷地区大约是 20%，比中国要高很多。

如果使用第一种方法，基本上是拿到一个市场的平均回报，也就是一轮基金下来大约是 31% 到 71% 的回报，如果扣除管理费和基金本身拿走的分红，出资人大约能得到 20%～50% 左右的回报。通常一期风险投资基金投资的时间是 2～5 年（持续的时间可以长达 7～10 年），这样年化回报大约是 5%～20% 之间。这是硅谷风险投资的平均水平，大家不要觉得风险投资一定能挣钱，在中国，大部分风险投资基金是赔钱的，而在硅谷赔钱的基金的比例也高达 40%。

第二种方法，只投一家，这其实是赌博，如果碰上这家公司上市，有 50 倍的回报，碰上被收购的有 2～5 倍的回报，但是绝大多数情况则血本无归。如果所有的基金都玩这样的赌博，虽然平均回报率和第一种情况相似，但是投资风险高达 500%。根据投资领域普遍采用的夏普比率（请回到《硅谷来信》查看第 145—148 封信）来衡量，这是极为糟糕的投资方式。

第三种方法是按照哈夫曼编码的原理，可以先把钱分成几部分逐步投入下去，每一次投资的公司呈指数减少，而金额倍增。具体操作方法如下：第一轮，选择 100 家公司，每家投入 25 万美元，这样用掉 2500 万美元；第二轮，假定有 1/3 的公司即 33 家表现较好，每家再投入 75 万美元左右，也用掉 2500 万美元。至于剩下了的 2/3 已经死掉或者不死不活的公司，千万不要救它们，更不要觉得便宜去抄底；第三轮，假定 1/10 的公司，即 10 家表现较好，每家投入 250 万美元，再用掉 2500 万美元；第四轮，假定 3% 的公司，即 3 家表现较好，每家投入 800 万美元左右，用掉最后的 2500 万美元。

这样通常不会错失上市的那一家，而且还能投中很多被收购的企业。由于大部分资金集中到了最后能够被收购和上市的企业中，占股份的比例较高，这种投资的回报要远远高于前两种，大家可以估算一下，大约有 3～10 倍的回报。

当然，这还达不到凯鹏华盈 40 倍的回报，但是已经非常好了。你也可以认为，一个系统的方法和坚守纪律能够带来 3～10 倍的回报，而对于凯鹏华盈来讲，投资人的经验和人脉，带来的是剩下的那几倍回报。

当然大部分人不会去参与风险投资，但是这种分配资源的原则在哪儿都适用。我在之前《Google 方法论》中介绍 Google 和 Facebook 等公司的管理方法时讲到，它们内部其实是一个大风投，各个项目一开始都有获得资源（主要是人力和财力）的可能性。但是很快，通常是三个月到半年，类似的项目就要开始整合，资源开始集中到更有希望的项目上去。最后能够变成产品上市的，是少数项目，但是大量的资源投入在其中了。这样既不会失去新的机会，也不会浪费资源。

今天的华为养了一个拥有几万人的庞大的预研部门，很多人觉得这是有了钱之后嘚瑟浪费，但是你可以把它看成是一个内部的大风投，每一个前期研究，都得到一定的发展机会，而投入的资源并不需要太多，最后能够进入到获得巨大资源攻坚阶段的项目，终究是少数。

这个道理对个人来讲也是适用的。美国有名的私立学校哈克学校的前校长尼克诺夫博士讲，在孩子小时候，要让他们尝试各种兴趣爱好，但是最终他们要在一个点上实现突破，他将这比做用圆规画圆，一方面有一个扎得很深的中心，另一方面有足够广的很浅的覆盖面。

## 要点总结

最后大家可能对我有一个问题。那就是你讲了半天哈夫曼编码，你自己是否采用了用它指导行动呢？简单的回答就是：「是的，我是这么做的。」

一方面我从来不排斥尝试新东西，这样不会失去机会，我尝试过的各种事情远比外界知道的多，只是绝大部分失败了，我没有继续罢了，大家也就无从知晓了。

但是，另一方面对于花了一些精力，看样子做不成的事情，我是坚决做减法止损，这样可以把最多的资源投入到我擅长的，有兴趣的，可能也是成功率最高的事情上。这算是我对今天内容的总结。

思考题：假定你有五天时间在巴黎度假，有些景点比较有名，你非常想去，但是可能比较拥挤。有些景点没有太大的名气，但是游人很少。你会如何安排这五天时间呢？

预告：下一讲，我们就从信息聚类的角度讲讲语言编码的变迁，比一比拼音文字和象形文字哪个是更有效的编码。

## 黑板墙

### 01

#### 1. 总结

今天吴老师要告诉我们的道理是：对事物抱有区别心。越频繁，就要越重视、给更多的关注。等长编码会浪费空间，因为它假定每个选项完全均等（也叫均匀分布），但是这种绝对平均的现象在现实中是极少出现的。而要做到有效性，你就要在进制相同、传递同样的信息的前提下，使用更少的编码。

你是否对上节课讲得「有效性」有更深的理解了呢？

#### 延伸阅读 —— 你至少记住 SOS 怎么表达吧？

莫尔斯电码也是最早用于数字化通信的形式之一，它的代码有五种：

#### 金勇分享 - 听风者

我在初中的时候玩过无线电测向，这在北京当时非常流行。在一个不大的公园内，老师藏好 3~10 部发射信号的电台（之间需要保持距离，避免干扰）。比赛一开始，我们就在公园里，一边听电台发布的信号一边解析，直到找出自己需要的那部。大家都像特工一样，要判断公园地形、其他人的位置，以及最重要的电台发出的信号。

哈夫曼编码可以做到少于五，因为它把出现概率最高的一条信息用两位来表示，所以最后的期望长度公式是：

	第一条信息概率 * 第一条编码长度 + 第二条信息概率 * 第二条编码长度 +....

这个结果最后比你的等长编码设计还好，这就是一种更有效的编码方案了。

### 02

我会在纸上或手机、电脑上列出这些景点，做出一张二维表。

第一天，出发前先通过各种旅游网站或 APP 查询其资源类型，首先排除掉自己一定不喜欢的类型，然后规划一条线路在第一天尽量多的快速遍历所有景点，晚上或路上对所有去过的景点做出评价，最好用量化指标来标定每个景点；第二天，在评分最高的三分之一的景点中规划路线，再较深度的游历一次，如果时间允许，带个导游来了解更多信息，晚上对白天的游览做小结，找到最喜欢的一两个景点；第三天到第五天，深度游，泡在最喜欢的景点，细细品味和享受旅游过程中的收获。

在大型展会上，我经常使用这种方式进行参观。先快速按图索骥找到最想看的一系列展位，有时会用笔标出并规划路线；然后在午餐时回顾和标记重点内容，并把资料袋中的内容做精简；下午重点了解几个最希望了解的展位，并和相关人员进行深入沟通。在实际操作中，还要考虑体力因素，要通过节约体力和充分休息来保证后期的旅行效果。

### 03

我也非常喜欢尝试新的东西和探索新的领域，像建筑工程，市场营销，心理学，脑神经科学，机器学习，数据分析，画画，钢琴，小提琴，法语，计算机语言，都有所涉猎，但不是每一项都坚持下来，也并非给予它们同等的热爱。

不是尝试过坚持下来的才叫成功，放弃的就叫失败，因为有些尝试的价值，就是为了告诉我，这条路不适合自己，要果断放弃；而有些尝试，则为我打开一个全新的世界，带给我不一样的看问题的视角和解决问题的方法，即便若干年后，忘记了所学的知识，但在探索过程中所领悟的「道」和思维上的升级，永远都在那里。所以时间会帮我淘出属于自己最纯的金子，只要不放弃探索的脚步。

现在，我终于找到了三个令自己兴奋不已并愿意为之奋斗一生的方向：

1、 研究有效学习方法，创建在学习中可迁移的思维模型库。我对思维方式的研究有着极大的兴趣，这和得到大学在做的事情不谋而合，只是打磨的方式不同，我从 2015 年开始就一边进行理论研究、一边在实践中探索，一边把它们写成书，当然这是一个需要不断完善的过程，但我乐此不疲。

2、艺术创作，慢慢形成自己独特的艺术风格，并保持开放，不断创新。

3、 目前在做三个领域（音乐、旅游、时尚）智能系统的研究，对于这个方向，现在充满激情，但是不确定能做出怎样的结果，也不确定是否会一直在这个领域深挖下去，所以摸着石头过河，边走边看。这三件事都有一个共同特点，就是我喜欢创新，喜欢原创，无论是理论模型，艺术创作，还是智能系统，我都希望做出自己独有的风格和价值。

随着方向的确定，我现在所有生活和工作的重心，都放在了这三件事情上。其余看似能短期为我带来利益的工作，能推则推，不能推就尽量花最短的时间去处理。有了明确的人生方向，每天都会充满激情，虽然奋斗的道路很辛苦，但同时充满惊喜和满足。直到现在，我才深刻体会到这句心灵鸡汤：每天叫醒你的不是闹钟，而是梦想。

### 04

信息论 | 最优 - 7

信源编码的本质，是将信息转化为适配信道传输的信号，压缩信源冗余度。可以分为两类：

1. 有损编码：舍弃部分次要信息，减少数据量及其冗余，提高压缩比。

2. 无损编码：又分为定长编码和变长编码。定长编码，即一个信源符号在编码转换后比特长度固定。变长编码，则将信源符号映射为不同的码字长度，Huffman 编码和 PB 编码都属于后者。

通过老师针对哈夫曼编码应用至投资行为中的解析，可以提炼出一个思维框架：以理论划定基线和极限，以权变为决策原则，分配风险，迭代认知和做事方法。对于学习者来说，知行合一，才可生其心。

思考：对于仅有五天的巴黎之旅，以 WLP（Weighted Path Length，带权路径长度）切入，基于「距离为路径长度，名气，个人偏好和历史意义等为权重」构筑路线决策模型。计算最终的加权平均码长，可以看到 Huffman 二叉树依然最优。另一个简单可偷懒的方法是，利用 Explore-Exploit 的三七法则，将一定距离区域内的景点分为两组，看 37% 名气大的和 37% 名气小的。