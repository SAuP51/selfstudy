## 第三堂课的 PPT

第3节：AutoLisp函数基础知识及条件/循环语句（一）

函数基础知识相关：

在计算机编程中，函数的作用和数学中的定义类似。函数是一组代码的集合，是程序中最小的功能模块，一次函数调用包括接收参数输入、数据处理、返回结果。同一个函数可以被一个或多个函数调用任意多次。

### 1.1 函数的写法（定义）

1、函数名。

2、参数相关：1）参数列表，形参和局部变量。2）形参和实参。

3、表达式语句。

### 1.2 函数的调用

### 1.3 普通函数与 CAD 调用函数的区别

区别：1）加 C: 。2）不能有形参。

### 1.4 command 调用 CAD 原生命令。

command + 原生命令 + 原生命令提示所需的数据。

### 1.5 匿名函数 lambda。

1、一般不会单独出现。基本都是跟一些高阶函数，比如 mapcar、apply 一起出现，把 lambda 函数作为一个参数传递给这些高阶函数用的。

2、即用即销。常规 defun 定义的函数是有一个函数名的，它存在内存里，在其他地方只要通过函数即可反复调用。但 lambda 函数只在你定义的地方用，用完就销毁了。

### 1.6 拆解函数（单一职责原则）。

拆解函数，短小。

Robert C. Martin 有一个信条：函数的第一规则是要短小，第二规则是要更短小。维护过遗留系统、受过超长函数折磨的读者应该深有体会，相比于 3000 行代码的「庞然大物」，肯定是更短小的函数更易于理解和维护。

有时保持代码的逻辑不变，只是把长方法改成多个短方法，代码的可读性就能提高很多。超长方法是典型的代码「坏味道」，对超长方法的结构化分解是提升代码可读性最有效的方式之一。

那么函数的代码行数多长才合适呢？

这没有一个绝对的量化标准，各团队可以有自己的标准，不同的开发语言可能会稍有不同。如果是 Java 语言，我建议一个方法不要超过 20 行代码，当我把这个规定作为团队代码审查的硬性指标后，发现代码质量得到了显著的改善。

有意识的去实践：Lisp 不要超 10 行。

单一职责原则。

把《代码精进》里的例子改成 autolisp，更佳方法是自己写一个 CAD 的类似的。比如批量改主物料管道的颜色。1）循环函数。2）过滤主物料管道图层。3）改颜色。干了三件事情。

按照行数规定函数的长度是定量的做法，实际上，我更喜欢另一种定性的衡量方法，即：一个方法只做一件事情，也就是函数级别的单一职责原则（Single Responsibility Principle，SRP）。

遵循 SRP 不仅可以提升代码的可读性，还能提升代码的可复用性。因为职责越单一，功能越内聚，就越有可能被复用，这和代码的行数没有直接的关联性，但是有间接的关联性。

通常，长方法意味着肯定需要拆分，需要用多个子函数的组合来进行更好的表达。然而短小的函数并不一定就意味着就不需要拆分，只要不满足 SRP，就值得进一步分解。哪怕分解后的子函数只有一行代码，只要有助于业务语义显性化的表达，就是值得的。

### 1.7 CAD 选择集函数详解

### 1.8 其他小知识点

1、末尾以一个变量结束，相当于函数返回了该变量值。

条件/循环语句知识相关（一）：

### 2.1 bool 逻辑运算。

and/or/not

### 2.2 条件语句

1、if 语句。

if判断，可以值、变量、语句、函数。

2、cond 语句。

提前预习1：课程上会用到的函数示例汇总。

[AutoCAD 2021 Developer and ObjectARX 帮助 | command-s (AutoLISP) | Autodesk](https://help.autodesk.com/view/OARX/2021/CHS/?guid=GUID-5C9DC003-3DD2-4770-95E7-7E19A4EE19A1)

[AutoCAD 2021 Developer and ObjectARX 帮助 | lambda (AutoLISP) | Autodesk](https://help.autodesk.com/view/OARX/2021/CHS/?guid=GUID-3B8BB020-1E1A-4FA3-B7B3-B5B20BA04CD9)

[AutoCAD 2021 Developer and ObjectARX 帮助 | if (AutoLISP) | Autodesk](https://help.autodesk.com/view/OARX/2021/CHS/?guid=GUID-916F1A5C-FD70-4D66-897E-6DCD666DCB39)

[AutoCAD 2021 Developer and ObjectARX 帮助 | cond (AutoLISP) | Autodesk](https://help.autodesk.com/view/OARX/2021/CHS/?guid=GUID-7BA45202-D95F-4F2D-8D83-965024826074)

提前预习2：大礼包里面书籍《2021137AutoCAD2008-VisualLisp》第 2 章第 2.6 节「函数」里的内容。