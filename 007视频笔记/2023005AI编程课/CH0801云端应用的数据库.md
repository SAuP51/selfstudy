### CH0801. 云端应用的数据库

### 01. 课件

如何编写一个有数据库的 Web 应用，我们需要：

1、数据库的概念、分类和常规用法。

2、SQLite 数据库的概念、用法和与 Python 语言的关联。

3、实操小红书文案的后台数据库。

01 什么是数据库

在计算中，数据库是指有组织的数据集合或基于数据库管理系统 (DBMS) 的一种数据存储。

数据库有对应的数据库管理系统，要经过这个系统才能操作数据库，这个系统提供了输入、存储和检索等功能。

02 数据库的分类

数据库类型分为关系型数据库和非关系型数据库。

关系型数据库（Relational database）是建立在关系模型基础上的数据库，是一种以表格作为架构的数据库。关系模型最基本的组成要素是实体，关系和属性。

非关系型数据库：非关系数据库是一种不使用表格架构的数据库。

03 数据库的 CRUD 操作

04 什么是 SQL

结构化查询语言 (Structured Query Language, SQL) 是一种的特定领域的语言。SQL 定义了操作所有关系型数据库的统一标准，而 MySQL 和 Sqlite 是该标准或语言的具体实现。

网址：[SQL - Wikipedia](https://en.wikipedia.org/wiki/SQL)

05 什么是 SQLite

SQLite 是一个用 C 编程语言编写的数据库引擎。它最大的特点是就是无服务器设计。

适合移动设备、桌面应用或任何需要单一文件数据库的场景。

网址：[SQLite Download Page](https://www.sqlite.org/download.html)

SQLlte Browser：[Downloads - DB Browser for SQLite](https://sqlitebrowser.org/dl/)

06 SQLite 的数据类型和语法

网址：[SQLite 教程 | 菜鸟教程](https://www.runoob.com/sqlite/sqlite-tutorial.html)

SQLite 的数据类型：

数据类型包括：空值 - Null、整数 - INTEGER、浮点 - REAL、文本 - TEXT、任意类型 - BLOB。

数据类型的约束：Not Null、Default、Unique、Primary、Check。

数据库的索引是一种特殊的查找表，数据库搜索引擎用来加快数据检索。

SQLite 的语法：

Database：数据库的增删、导入、导出数据。

Table：表的增删、数据的增删改查。

Condition：设置不同条件查找数据。

Other：时间及其他辅助功能。

07 SQLite 的实操流程

Sqlite => database => table => entities => attribure => type

08 SQL 的风险

1、SQL 注入风险：使用一段 SQL 代码来操纵数据库并访问可能有价值的信息。

2、代码的可读性和维护性：当 SQL 语句与 Python 代码混合时，使得代码难以阅读和维护。

3、对象与数据不一致：在传统的 SQL 中，你需要手动将查询结果转化为 Python 对象，或者将 Python 对象转化为 SQL 插入/更新语句。这个过程容易出错且重复。

09 什么是 ORM

参考网址：

[ORM 实例教程 - 阮一峰的网络日志](https://www.ruanyifeng.com/blog/2019/02/orm-tutorial.html)

ORM 是「对象-关系映射」（Object/Relational Mapping）的缩写，是一种在关系数据库和面向对象编程语言的堆之间转换数据的编程技术。

数据库的表（table）-> 类（class）

记录（record，行数据）-> 对象（object）

字段（field）-> 对象的属性 (attribute)

10 Python 中的 ORM

python 中的 ORM 是 SQLAlchemy。

参考网址：

[SQLAlchemy - The Database Toolkit for Python](https://www.sqlalchemy.org/)

11 实操：小红书文案生成器的后台数据库

12 实操：如何部署云端应用

coding 关联腾讯云：

[如何在腾讯轻量应用服务器部署 fastapi - 飞书云文档](https://p7een9o397.feishu.cn/docx/CxxgdLixnox1jWxjWaYcnXadnjh)

### 02. 实操是遇到的问题

1、建完数据库没法在里面执行 SQL 语句。

也是询问 GPT 的时候无意中，在其问题里 get 了自己反的错误。我新建数据库命令的时候只输入了 demo，没有带文件类型名。应该输入完成的 demo.db，然后进去后就可以执行 SQL 了。

2、安装项目配套的三方包时报错，原因是需要 Python3.8 版本，目前自己的是 Python3.7 的。

解决方案：好在在 conda 虚拟环境中升版 Python 很方便，而且不会影响到其他虚拟环境的包。在虚拟环境中运行下面命令即可。

conda install python=3.8

后来发现有很多其他包，要求 Python 最高的版本是 3.10，就索性升级到了 3.10。

3、安装三方包是遇到的一系列问题。

那个 requirements.txt 有不少包，重复了 2 次，而且不同的版本，会冲突，要删除。

安装 jnius 包时，由于缺少 Cython 这个必要的依赖，导致安装失败。要么手动安装 Cython 包：pip install Cython。要么把 Cython 包的信息直接写到 requirements.txt 里：Cython==3.0.5。

安装不了包 xmlrpclib。问 GPT 后的回复：

错误信息表明你尝试安装的 `xmlrpclib` 版本1.0.1在PyPI上不存在。`xmlrpclib` 是Python 2的一个标准库，用于处理XML-RPC。在Python 3中，这个库已经被重命名并集成到了 `xmlrpc.client` 模块中，所以不再需要单独安装。

如果你的代码是为Python 2编写的，你应该考虑将其升级到Python 3。如果升级不是一个选项，你需要确认你使用的是Python 2环境，并且不需要安装 `xmlrpclib`，因为它已经是标准库的一部分了。

如果你正在使用Python 3，你应该将代码中的 `xmlrpclib` 引用更新为 `xmlrpc.client`。例如，如果你的代码中有这样的语句：

```python
import xmlrpclib
```

你应该将其更改为：

```python
import xmlrpc.client
```

并且确保你的代码中的其他 `xmlrpclib` 引用也做相应的更新。

如果你确实需要安装一个第三方包，确保你有正确的包名和版本号。你可以在PyPI官网（https://pypi.org/）搜索你需要的包来确认。如果是私有包或者内部服务器上的包，你需要确保你的pip配置能够访问正确的服务器或者索引。

最终还是没装上三方包 jnius。看后续项目是不是真的需要用这个包，到时再解决。（2023-11-16）


### 03. 实操获取的知识点

1、函数修饰器。

函数作为一个参数传递给另一个函数，高阶函数的概念。

### 04. 其他

基础作业是让 GPT 做的。
