# 0401. 条件概率：贝叶斯公式的基础

刘嘉·概率论 22 讲

2020-08-01

从这一讲开始，我们就进入了课程的最后一模块 —— 贝叶斯。这是我们要攻克的最后一个山头，也是最难的一个。为了顺利攻克这个山头，在具体讲贝叶斯推理、贝叶斯计算之前，我们得借助一个梯子。这个梯子就叫作「条件概率」。真正弄懂条件概率，就是我们这一讲的重点。

## 1.1 什么是条件概率？

平时的生活里，你肯定听过这样的话，「今晚刮大风了，明天应该不是雾霾天」「他昨天晚上睡得很晚，今天应该不会早起」，再比如「头大脖子粗，不是老板就是伙夫」…… 当然，这些话都很有道理，但你思考过没有，这些判断都是怎么得来的呢？它们的依据是什么呢？

其实，这背后的逻辑就是条件概率。所谓的条件概率，通俗来讲就是，如果一个随机事件的概率会因为某个条件而产生变化，那在这个条件发生的情况下，这个随机事件发生的概率就是条件概率。因为今天晚上刮大风了，所以明天雾霾的概率大大降低；因为昨天晚睡了，所以今天大概率不会早起；因为头大脖子粗，所以是老板或伙夫的概率就大大提升。这不就是条件概率吗？

这样的例子，简直无处不在。比如我告诉你，我在文章里看到了一个词 —— 苹果，请问我说的是苹果这种水果，还是美国的苹果公司呢？不好判断吧？但是如果告诉你，文章讲的是科技企业，那自然的，它指代苹果公司的概率就要大一些；如果我正在看父亲发给我的养生文章，那它指代苹果这种水果的概率就更大；而如果我告诉你，这是一篇讲供应链的文章呢？那这里的苹果既有可能是水果，也有可能指苹果公司，具体是哪个，就不好判断了。

你看，条件不一样，概率就会发生变化。这就是条件概率。其实，条件概率具体的计算是有公式的，代入公式可以直接计算 ——

```
P(A│B) = P(AB)/P(B)
```

其中，P(A│B) 为条件概率，表示在 B 条件下 A 发生的概率；P (AB) 为事件 A、B 同时发生的概率；P (B) 为事件 B 发生的概率。不过，我们主要是了解这个思想，公式本身不那么重要。

举个例子：幼儿园某班的小朋友，60% 喜欢巧克力冰淇淋，30% 喜欢巧克力冰淇淋和草莓冰淇淋。问在喜欢巧克力冰淇淋的人里，也喜欢草莓冰淇淋的百分比是多少？

假设有 100 个小朋友，60 个喜欢巧克力冰激凌，30 个喜欢巧克力冰激凌和草莓冰激凌，很明显，在喜欢巧克力冰激凌的 60 个人中，有 30 个人还喜欢草莓冰激凌，所以答案是 50%。带入条件概率公式，结果也是一样：A = 喜欢吃草莓冰淇淋，B = 喜欢吃巧克力冰淇淋

```
P(A│B) = P(AB)/P(B) = 0.3/0.6 = 0.5
```

## 1.2 一切概率都是条件概率

听上去似乎很简单，但现实中，要识别条件概率其实并不容易。还记得咱们讲独立性的时候举的双黄蛋的例子吗？把鸡蛋装入盒子这件事，看起来是完全独立的。但真的是这样的吗？

前面说过，双黄蛋普遍个头比较大，在芸芸众蛋中十分显眼。同时，鸡蛋大小不同，价格也往往不一样。所以，无论是工作人员还是自动化机器，都更倾向于按鸡蛋的大小甚至重量来区分、装盒。就这样，当装入盒子的第一个是大个的双黄蛋时，也就是在「第一个是双黄蛋」这个条件下，后续也是双黄蛋的概率就会大大增加。你看，看似独立，其实是有条件的。

再比如，你家隔壁搬来一个新邻居，中年男人，斯斯文文的，戴个眼镜。现在我问你，新邻居更可能是医生，还是工程师呢？你会怎么想？「我怎么知道？一半对一半吧。」其实不对。因为在一个城市里，工程师和医生的数量是不一样的，工程师的数量可能是医生的 10 倍还不止。也就是说，这时候，邻居是医生的概率只有工程师的 1/10。猜一半对一半，可就差太远了。再比如，如果你们小区是医院的家属楼，那相应的，新邻居是医生的概率可能又要远远高于工程师了。你看，新邻居是医生还是工程师，看起来也没有条件吧？但其实，它隐藏的有条件，那就是「工程师和医生的数量是不一样的」。如果下意识的忽视这个条件，认为工程师和医生数量一样，一半对一半，结果就会错得离谱。

发现了吗？很多我们以为完全独立、没有条件的随机事件，其实都是有条件的，只不过它们的条件隐藏得很深，不那么容易被发现。如果忽视了这些条件，可就要犯错了。

其实严格来说，所有的概率问题都是基于条件的。像我们刚才说的例子，都有条件吧？就连最简单的、概率论老师都愿意举的抛硬币的例子，其实也隐藏了很多条件。当我们说「硬币正面朝上的概率是 50%」时，其实就隐含了很多条件。比如「这个硬币是公平的」「抛硬币的手法没问题」「空气密度不影响硬币的结果」「气流不会对硬币产生干扰」等。再比如，我们说「明天太阳照常升起的概率是 100%」时，是不是没条件了呢？这不是客观规律吗？不，它也是有条件的。条件就是地球还在围绕太阳转，太阳系还没毁灭。真要是流浪地球了，不就看不到太阳升起了吗？你看，都有条件。

本质上，现实世界所有的概率都是条件概率。

## 1.3 操纵条件，改变概率

既然所有概率都是条件概率，那相应的，只要学会操纵这些条件，我们就能改变随机事件发生的概率。往小了说，可以避免自己被套路，陷入别人的骗局；往大了说，可以获得一些别人没有的优势，为自己争取更多的利益。

### 1.3.1 运用条件概率识别骗局，避免被套路。

有一件事特别能说明这一点，就是法律界无人不知的「辛普森案」。案子的细节我就不多说了。如果想了解，你可以去听刘晗老师的《刘晗讲辛普森案》。咱们主要说一点，在这个案件的法庭辩论上，双方律师对一个条件概率的问题产生了严重的分歧。

在庭审的最初 10 天，原告举出了无数证据，证明辛普森常常家暴前妻。他们认为，「一个巴掌可能就是谋杀的前兆」，长期家暴说明辛普森有谋杀前妻的动机。而被告律师则反驳说，家暴和谋杀没有必然关系。因为美国有 400 万被家暴的妻子，但只有 1432 名被丈夫杀害，这个概率只有 1432 除以 400 万，比 1/2500 还低。所以，家暴证明不了辛普森谋杀。

你看，被告律师其实说的是，在家暴这个条件下，一个人谋杀妻子的概率并不会大大增加，所以不能判定辛普森有罪。还举出了数据，听起来似乎有理有据。如果你是陪审团成员，你能相信他吗？答案是，不能。

为什么呢？因为在刚才的计算中，被告律师其实忽视了一个条件 —— 辛普森的前妻已经被杀害。一旦「前妻已经被杀害」这个条件出现，问题就不再是「在家暴的条件下，丈夫谋杀妻子的概率是多少」了，而是变成了「在丈夫家暴妻子，而且妻子已经死于谋杀的双重条件下，杀人凶手是丈夫的概率是多少」。

多了这一个条件，计算结果可是千差万别。「在丈夫家暴妻子，且妻子已经死于谋杀的双重条件下，杀人凶手是丈夫的概率是多少」这个问题的反面是什么呢？是「妻子已经被杀害，但杀人凶手不是丈夫，而是其他人」。而按照被告律师的思路，他们求的是「在家暴的条件下，丈夫谋杀妻子的概率是多少」。这个问题的反面是什么呢？是「在家暴的条件下，妻子没有被谋杀的概率是多少」。显然，这是完全不同的两个概率问题。

事实上，如果真要算起来，这个条件概率要远远高于 1/2500。还是按照被告律师的数据，再结合美国 1992 年的数据，很多人大致做了个推演。在丈夫经常家暴妻子，且妻子确实死于谋杀这双重条件下，杀人凶手是丈夫的概率是多少呢？高达 93%。也就是说，被家暴的美国妇女如果死于谋杀，凶手不是自己丈夫的概率只有 7%。

让我们使用频率法，把概率和百分比转换成事件发生的次数。如果有 100000 个被丈夫家暴过的妇女，那么其中大概有 40 个妇女最终会被丈夫谋杀（1/2500×100000=40）。而根据美国联邦调查局于 1992 年发布的女性被谋杀的数据推算，每 100000 个被家暴的妇女中有 43 个会被谋杀。所以，还有 3 个妇女被丈夫以外的人谋杀了。也就是说，被谋杀的 43 位妇女中，有 40 个是被对她们实施家暴的丈夫杀掉的。因此，在已知丈夫殴打妻子且妻子被人谋杀的双重条件下，丈夫谋杀妻子的概率高达 93%。

条件概率的计算如下：

事件 A：妻子被丈夫杀害。

事件 B：妻子被家暴且妻子死亡。

则在妻子被家暴且被谋杀的双重条件下，妻子是被丈夫杀害的概率 `P(A│B) = P(AB)/P(B) = (40/100000)/((40+3)/100000) = 0.93`。

当时，被告律师团队阵容非常豪华，还有哈佛大学的教授，所以我相信，他们肯定不是错误地使用了条件概率，而是巧妙地运用了辩论技巧，故意设了个骗局来欺骗陪审团。如果我们没有真正了解条件概率，很容易就会上他们的当，被他们带到沟里。当然，必须得多说一句：即使概率高达 93%，也不能证明辛普森杀害了妻子。条件概率只表示统计意义上的相关性，并不代表因果关系。家暴并不一定导致谋杀，但家暴和谋杀妻子之间确实有很强的相关性。

### 1.3.2 操纵条件改变概率，为自己赢取优势。

你应该听过「高频交易」这个词吧？通过快速的买进卖出，这些人能获取远超市场平均值的收益。听起来很高端，但其实它的本质就是条件概率。

我们知道，影响股价的因素太多了。一年、一个月、甚至一星期、一天内都有各种正面、负面的信息汇集在一起，很难把握。但是，如果缩小时间片段，在一秒，甚至一毫秒这样短的时间内，影响股价的因素就变得比较单一了。这时候，再去把握关键因素，难度就会小一些，盈利的概率就会大一些。这就是高频交易的基础。你看，还是条件概率。说白了，条件概率就是计算和量化某个条件对随机事件的影响。日常生活中，我们总说「找到关键因素」，学完这一讲你会发现，我们其实是在寻找对这件事产生重大影响的条件。是的，我们在计算条件概率。

## 黑板墙

留一道有点敏感的思考题：社会上，经常有女性穿着暴露与被侵犯之间关系的讨论。穿着暴露肯定不是被侵犯的理由，每个人都有穿衣自由，这一点是一定的。但你能从条件概率的角度，分析一下这件事吗？

下节预告：讲完了贝叶斯推理的基础 —— 条件概率，下一讲，我们就进入贝叶斯推理。

### 01

条件概率计算的前提，就是这两者之间确实有关系，那穿着暴露和被侵犯之间是不是存在因果联系呢？我们看一组调查。根据联合国的相关統计数据，全球性侵发生率最高的地方，在中东、非洲、南亚和中美洲地区，这些地区的女性，很多地方穿着上还是很保守的，而那些穿着暴露、性感大胆的国家，比如欧美，性侵的发生率反而很低。另外，女性在夏季的穿着普遍要更加性感，但是，在性侵案的时间分布上，夏季并不明显高于冬季。之前有一个展览，展示了性侵受害者案发时所穿的服装，从中可以看出，穿着保守并不能避免性侵的发生。

总体来说，性侵的发生，最重要的因素还是环境。大环境是社会环境，那些筼穷落后，或社会秩序不稳定的地方，会显著增加性侵的发生率。小环境是案发现场，是不是有利于犯罪分子作案，比如人烟稀少的地方。另外，还有两点和性侵的发生有关，一个是受害者的气质，胆怯、害羞的小白兔气质，更容易成为被侵害的目标；另一个就是熟人作案的几率更大，这个可能是很多人没想到的，犯罪分子下手前也会充分了解作案对象。

作者回复：是的，影响被侵犯的因素中，国家犯罪率、单独、隐秘的环境等等都可能比穿着暴露更能改变被侵犯的概率。打破刻板印象，需要计算条件概率。

### 03

首先要统计女性在穿着暴露的情况下被侵犯的概率是多少；其次，在統计女性被侵犯的概率是多少；最后，比较这两个概率，看看女性穿着暴露是不是与被侵犯有些强相关性（也就是说，穿着暴露是不是女性被侵犯的关键因素）。

在生活中，运用条件概率解决问题的真实案例：1989 年，物理学家列纳德·蒙洛迪诺（《星际迷航》作者）为了申请保险，接受了一次抽血检查，检查项目 HIV，也就是导致艾滋病的那种病毒。很不幸的是，他的这项检査结果是阳性的。医生告诉他，这个结果意味着，他有 99.9% 的概率得了艾滋病。以当时 1989 年的医疗水平，他会在 10 年内死去。

但幸运的是蒙洛迪诺懂贝叶斯定理。他知道医生错了。其实，我们要识别的问题是：蒙洛迪诺做了一个检查正确率是 99.9% 的检查，结果是阳性的情况下，蒙洛迪诺得艾滋病的概率是多少？但是，医生没有考虑到一个条件：蒙洛迪诺所处的群体，他们的发病率是多少。而蒙洛迪诺所处的群体，艾滋病的发病率是 1/10000。这时候计算可得，蒙洛迪诺得病的真实概率是 9.1%，而不是 99.9%。这两者的差别一个天上一个地下。所以他没有惊慌，他再次做了检査，结果证明，他的确没有得艾滋病。

作者回复：前面非常好，只有最后一点我不同意，「蒙洛迪诺得病的真实概率是 9.1%，而不是 99.9%」。贝叶斯计算往往用疾病这个例子，突破大家的认知，觉得好意外。但现实从来不是做题。

1、即便是 9.1%，从万分之一上升到几乎十分之一，说明检查这件事非常重要，检查结果对概率的变化起了決定性因素。

2、得病的「真实」概率可能是高于 9.1%，因为并不是所有人都会参加艾滋病检査，参加艾滋病检查的不是简单随机，这里有个条件，就是你觉得不好才去检查的，或者医生觉得不好才去检査的，往往先验概率是高于发病率的。这是一个条件概率。

3、你也需要知道，患病率的万分之一的含义是什么？大部分的含义是生病的人数除以总人数，这时候第二点你就能理解了，也有可能就是生病人数除以检查人数，那贝叶斯算出来的 9.1%，就真实可靠了。

4、处理措施只有一个，再次检查。所有被检査出大病，真正的概率思维直觉就是再做检査。一般情況，三次检査都是阳性，你误诊的概率会非常低。

### 03

这一讲让我想起了那个经典的问题：有个哥们儿叫老王，他非常害羞，喜欢自己待着；他总是帮助别人，对社交和社会现实也不太感兴趣；他整洁、温顺，喜欢秩序与结构，对细节也极其关注。，老王最可能是哪个职业？A 是农民，B 是销售员，C 是图书馆管理员，D 是内科医生。一般来说，答案会告诉我们是 A，因为社会中农民数量最多。并且认为选择 C 的人是产生了代表性偏差。但我一直觉得认为这个题目有问题。我认为既然题目已经通过特征描述限定了样本范围，再用总体概率计算是不对的。换言之，我们应该参考的是满足题目条件人群各个职业的比例，而非整体人群的职业比例。

举个简单的例子，一个男女人数比是 4 比 6 的社会里，现在有个人 188cm、80kg，平时出门不会特别化妆打扮，经常去健身房，体育馆，网吧等场地。现在问这个人是男是女。这时应该根据大数据概率选女性吗？显然不对吧。请问刘老师，我这样考虑对吗？

作者回复：这本是表达「基础比率谬误」的。在第一个描述中，这种安静并不是这四个职业最显著的特征。所以按照人口比率来考虑。而在第二个描述中，就未必了，你可以想象一下，假设 1000 个人，400 个男生，600 个女生，满足 188cm、80kg，很可能只有 45 个男生符合，而可能只有 5 个女生符合。这时候，是男生的概率达到 90%。但是，一定要记住现实不是做题。寻找那个最关键因素的能力，那个最可能影响概率变化的条件才叫洞察力。

### 04

作者回复：这题目的关键，不是马上做出決定，无论是穿着暴露会提升被侵犯的概率，还是穿着暴露不是被侵犯的理由。学习概率的基本素养是：证据。是客观的可以代入条件概率公式的数据。关键我们需要了解 P(AB) 也就是被侵犯且穿着暴露，以及 P(B) 被侵犯的概率。目前我没有找到任何支持穿着暴露和被侵犯之间的关系的数据，我没有办法判断。而有可能更直接的条件概率是，独自在人少的角落，会增加危险。

### 05

这节课后有两个疑难：一是面对一个求解条件概率问题，如何洞察分析出各相关条件和主要条件？二是找到条件后如何获得相关数据？

作者回复：条件概率公式很简单，不需要辨别这些，用频率法也可以做，在 B 条件下 A 发生的概率，就等于 AB 共同发生的概率除以 B 发生的概率。条件概率不表达任何因果关系，只表达在某个随机事件发生的时候，另一个随机事件的概率发生了变化。

### 06

1、穿着暴露与被侵犯之间只能说存在相关关系，严格说穿着暴露存在被侵犯的可能性，而一旦被侵犯则不能说完全由于穿着暴露而导致，穿着暴露是被侵犯的必要非充分条件。一旦被侵犯了，则变为穿着暴露且被侵犯的条件下，侵犯者的动机究竟如何。

2、这节课让我想到《统计学关我什么事》中也提到，贝叶斯概率精准之处就在于面对具体事件的判断，而非一殷惯性思维喜欢采用大量同类事件发生的总体概率。比如在 52 张牌中（去掉大小王）抽出任意一种花色的概率是 1/4，但是如果抽牌之前被告知，请抽出一张黑色花色的牌，则概率立刻变成了 1/2，因为条件发生了変化。贝叶斯厉害的地方就是能够把普遍的大样本下的先验概率经过推理后转化为精准的条件概率。

### 07

讲到贝叶斯公式的时候，常常会拿疾病患病率来举例。但是我一直在疑惑：人群中某种疾病的发病率真的等于某个具体的个人这种疾病的发病率吗？举个例子，主动脉夹层是一种非常凶险的疾病，在人群中的发病率为 4.3/10 万，发病率非常低。如果一个人很年轻的时候就患上了高血压，有动脉硬化的迹象，常常鼻出血，眼结膜出血，脾气暴躁，那么即便是没有检测到任何主动脉夹层的征兆，也不能按照上述概率来估算，而是要大大提高他患此病的概率，从而严加防范。所以我总觉得不考虑个体情况，只是按照大数样本来计算某个人得病的概率，有时候恐怕会犯非常严重的错误。

作者回复：当然不等于，现实不是做数学题。1）患病率不能直接计算，因为你是身体感觉不好，医生初步诊断之后オ去检查的，这个概率远比平均患病率要高；2）家族、基因、环境、年纪都会让某个群体，或者某个个体的的患病概率大幅度提升。这都是条件概率。

### 08

贝叶斯公式是关于随机事件 A 和 B 的条件概率（或边缘概率）的一则定理，早在 18 世纪，就由英国学者贝叶斯提出了相应的计算公式。虽然只是一条简单的公式，但其原理其实毋需数字也可明了。比如说，我们看到一个人总是做一些好事，那么那个人是好人的概率就会很高。这就是说，当我们不能准确知悉一个事物的本质时，可以依靠与事物特定本质相关的事件出现的多少去判断其本质属性的概率。用数学语言表达就是：支持某项属性的事件发生得愈多，则该属性成立的可能性就恵大。可以说，贝叶斯公式的思路对于由证据的积累来推测一个事物发生的概率具有重大作用；它告诉我们，当我们需要对事物进行预测的时候，首先是要根据已有的经验和知识推断一个先验概率，然后在新证据不断积累的情况下调整这个概率。

不过，真实世界中，很多时候我们也会因为不理解而误用条件概率。比如课程中提到著名的辛普森案，为了证明辛普森有罪，检方指控辛普森之前家暴的历史；而方律师则说，美国有 400 万女性被夫或男友打过，而其中只有 1432 人被杀，概率是 2800 分之一。这其实就是误用了条件概率，因为辩方律师用的条件是家暴，用来推测的事件是男友杀人；而案件里的条件是被杀而且有家暴，而要推测的事件是凶手是男友（事实上概率高达 90% 左右），这才是贝叶斯分析的正当用法，而方律师却是故意在混淆条件与要验证的假设。所以，理解了贝叶斯公式和条件概率，就能够帮助我们更好的分清条件和假设之间的关系，从而避免误判。

### 09

很好奇，老师为啥没有把贝叶斯公式放在最前面讲呢？是因为最精彩的要留在最后吗条件概率，条件就是概率的灵魂。

作者回复：因为贝叶斯公式是条件概率公式的一个小小地形。